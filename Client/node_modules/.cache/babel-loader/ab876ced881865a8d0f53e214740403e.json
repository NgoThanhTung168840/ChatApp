{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Tung Thanh\\\\Desktop\\\\Project_HPT\\\\react-spring-messenger-project\\\\Client\\\\src\\\\components\\\\websocket\\\\call-window-component.tsx\",\n  _s = $RefreshSig$();\nimport CallIcon from \"@mui/icons-material/Call\";\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } from \"@mui/material\";\nimport React from \"react\";\nimport { UUIDv4 } from \"../../utils/uuid-generator\";\nimport { useWebSocketContext } from \"../../context/ws-context\";\nimport { RtcTransportDTO } from \"../../interface-contract/rtc-transport-model\";\nimport { RtcActionEnum } from \"../../utils/rtc-action-enum\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setCallIncoming, setCallUrl, setGroupWithCurrentCall } from \"../../reducers\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const CallWindowComponent = _ref => {\n  _s();\n  let {\n    userId,\n    groupUrl\n  } = _ref;\n  const {\n    ws\n  } = useWebSocketContext();\n  const dispatch = useDispatch();\n  const {\n    callStarted,\n    callUrl\n  } = useSelector(state => state.globalReducer);\n  const openCallPage = async event => {\n    event.preventDefault();\n    const startedCallUrl = UUIDv4();\n    if (ws) {\n      const transport = new RtcTransportDTO(userId, groupUrl, RtcActionEnum.INIT_ROOM);\n      ws.publish({\n        destination: `/app/rtc/${startedCallUrl}`,\n        body: JSON.stringify(transport)\n      });\n      const callPage = window.open(`http://localhost:3000/call/${startedCallUrl}`, \"_blank\");\n      if (callPage) {\n        callPage.groupUrl = groupUrl;\n        callPage.focus();\n      }\n      dispatch(setGroupWithCurrentCall({\n        roomUrl: startedCallUrl,\n        groupUrl\n      }));\n    }\n  };\n  const handleClose = () => {\n    dispatch(setCallIncoming({\n      callStarted: false\n    }));\n    dispatch(setCallUrl({\n      callUrl: \"\"\n    }));\n  };\n  const startCall = () => {\n    var _window$open;\n    dispatch(setCallIncoming({\n      callStarted: false\n    }));\n    (_window$open = window.open(`http://localhost:3000/call/${callUrl}?mode=join`, \"_blank\")) === null || _window$open === void 0 ? void 0 : _window$open.focus();\n  };\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Button, {\n      onClick: event => openCallPage(event),\n      variant: \"text\",\n      component: \"span\",\n      children: /*#__PURE__*/_jsxDEV(CallIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 3\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: callStarted,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        id: \"alert-dialog-title\",\n        children: \"Someone is calling you\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(DialogContentText, {\n          id: \"alert-dialog-description\",\n          children: \"Do you want to answer this call ? You can accept or deny the call\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 3\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 63,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => handleClose(),\n          color: \"primary\",\n          children: \"Deny\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 3\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => startCall(),\n          color: \"primary\",\n          children: \"Accept\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 3\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 3\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"remote-video\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 3\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n};\n_s(CallWindowComponent, \"MljsBskrx+c2/ngHQunx7Y04TkU=\", false, function () {\n  return [useWebSocketContext, useDispatch, useSelector];\n});\n_c = CallWindowComponent;\nvar _c;\n$RefreshReg$(_c, \"CallWindowComponent\");","map":{"version":3,"names":["CallIcon","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","React","UUIDv4","useWebSocketContext","RtcTransportDTO","RtcActionEnum","useDispatch","useSelector","setCallIncoming","setCallUrl","setGroupWithCurrentCall","CallWindowComponent","userId","groupUrl","ws","dispatch","callStarted","callUrl","state","globalReducer","openCallPage","event","preventDefault","startedCallUrl","transport","INIT_ROOM","publish","destination","body","JSON","stringify","callPage","window","open","focus","roomUrl","handleClose","startCall"],"sources":["C:/Users/Tung Thanh/Desktop/Project_HPT/react-spring-messenger-project/Client/src/components/websocket/call-window-component.tsx"],"sourcesContent":["import CallIcon from \"@mui/icons-material/Call\"\r\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } from \"@mui/material\"\r\nimport React from \"react\"\r\nimport { UUIDv4 } from \"../../utils/uuid-generator\"\r\nimport { useWebSocketContext } from \"../../context/ws-context\"\r\nimport { RtcTransportDTO } from \"../../interface-contract/rtc-transport-model\"\r\nimport { RtcActionEnum } from \"../../utils/rtc-action-enum\"\r\nimport { useDispatch, useSelector } from \"react-redux\"\r\nimport { StoreState } from \"../../reducers/types\"\r\nimport { setCallIncoming, setCallUrl, setGroupWithCurrentCall } from \"../../reducers\"\r\n\r\nexport const CallWindowComponent: React.FunctionComponent<{ userId: number, groupUrl: string }> = ({\r\n  userId,\r\n  groupUrl\r\n}) => {\r\n  const { ws } = useWebSocketContext()\r\n  const dispatch = useDispatch()\r\n  const {\r\n    callStarted,\r\n    callUrl\r\n  } = useSelector(\r\n    (state: StoreState) => state.globalReducer\r\n  )\r\n\r\n  const openCallPage = async (event: any) => {\r\n    event.preventDefault()\r\n    const startedCallUrl = UUIDv4()\r\n    if (ws) {\r\n\t const transport = new RtcTransportDTO(userId, groupUrl, RtcActionEnum.INIT_ROOM)\r\n\t ws.publish({\r\n\t   destination: `/app/rtc/${startedCallUrl}`,\r\n\t   body: JSON.stringify(transport)\r\n\t })\r\n\t const callPage = window.open(`http://localhost:3000/call/${startedCallUrl}`, \"_blank\") as any\r\n\t if (callPage) {\r\n\t   callPage.groupUrl = groupUrl\r\n\t   callPage.focus()\r\n\t }\r\n\t dispatch(setGroupWithCurrentCall({\r\n\t   roomUrl: startedCallUrl,\r\n\t   groupUrl\r\n\t }))\r\n    }\r\n  }\r\n\r\n  const handleClose = () => {\r\n    dispatch(setCallIncoming({ callStarted: false }))\r\n    dispatch(setCallUrl({ callUrl: \"\" }))\r\n  }\r\n\r\n  const startCall = () => {\r\n    dispatch(setCallIncoming({ callStarted: false }))\r\n    window.open(`http://localhost:3000/call/${callUrl}?mode=join`, \"_blank\")?.focus()\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n\t <Button onClick={(event: any) => openCallPage(event)} variant=\"text\" component=\"span\">\r\n\t   <CallIcon/>\r\n\t </Button>\r\n\t <Dialog open={callStarted}>\r\n\t   <DialogTitle id=\"alert-dialog-title\">{\"Someone is calling you\"}</DialogTitle>\r\n\t   <DialogContent>\r\n\t\t<DialogContentText id=\"alert-dialog-description\">\r\n\t\t  Do you want to answer this call ? You can accept or deny the call\r\n\t\t</DialogContentText>\r\n\t   </DialogContent>\r\n\t   <DialogActions>\r\n\t\t<Button onClick={() => handleClose()} color=\"primary\">\r\n\t\t  Deny\r\n\t\t</Button>\r\n\t\t<Button onClick={() => startCall()} color=\"primary\">\r\n\t\t  Accept\r\n\t\t</Button>\r\n\t   </DialogActions>\r\n\t </Dialog>\r\n\t <div id={\"remote-video\"}/>\r\n    </React.Fragment>\r\n  )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}